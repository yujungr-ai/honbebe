# π“ ν”„λ΅μ νΈ κµ¬μ΅°

```
ebitda-api/
β”‚
β”β”€β”€ app/                                # μ• ν”λ¦¬μΌ€μ΄μ… μ½”λ“
β”‚   β”β”€β”€ __init__.py
β”‚   β”β”€β”€ main.py                         # FastAPI μ—”νΈλ¦¬ν¬μΈνΈ (117μ¤„)
β”‚   β”β”€β”€ config.py                       # ν™κ²½λ³€μ μ„¤μ • κ΄€λ¦¬ (35μ¤„)
β”‚   β”β”€β”€ models.py                       # Pydantic λ°μ΄ν„° λ¨λΈ (80μ¤„)
β”‚   β”‚
β”‚   β”β”€β”€ services/                       # λΉ„μ¦λ‹μ¤ λ΅μ§
β”‚   β”‚   β”β”€β”€ __init__.py
β”‚   β”‚   β”β”€β”€ dart_client.py              # OPENDART API ν΄λΌμ΄μ–ΈνΈ (149μ¤„)
β”‚   β”‚   β”β”€β”€ corp_resolver.py            # corp_code λ§¤ν•‘ μ„λΉ„μ¤ (147μ¤„)
β”‚   β”‚   β”β”€β”€ financial_service.py        # μ¬λ¬΄μ •λ³΄ μ΅°ν μ„λΉ„μ¤ (118μ¤„)
β”‚   β”‚   β””β”€β”€ ebitda_calculator.py        # EBITDA κ³„μ‚° λ΅μ§ (207μ¤„)
β”‚   β”‚
β”‚   β”β”€β”€ utils/                          # μ ν‹Έλ¦¬ν‹°
β”‚   β”‚   β”β”€β”€ __init__.py
β”‚   β”‚   β”β”€β”€ cache.py                    # SQLite μΊμ‹± μ‹μ¤ν… (132μ¤„)
β”‚   β”‚   β””β”€β”€ rate_limiter.py             # Rate Limiting μ ν‹Έλ¦¬ν‹° (101μ¤„)
β”‚   β”‚
β”‚   β””β”€β”€ routers/                        # API λΌμ°ν„°
β”‚       β”β”€β”€ __init__.py
β”‚       β””β”€β”€ ebitda.py                   # EBITDA API μ—”λ“ν¬μΈνΈ (130μ¤„)
β”‚
β”β”€β”€ data/                               # λ°μ΄ν„° μ €μ¥μ†
β”‚   β””β”€β”€ cache/                          # μΊμ‹ λ””λ ‰ν† λ¦¬
β”‚       β”β”€β”€ cache.db                    # SQLite μΊμ‹ DB (μλ™ μƒμ„±)
β”‚       β””β”€β”€ corp_code.xml               # κ³ μ λ²νΈ λ§¤ν•‘ (μλ™ λ‹¤μ΄λ΅λ“)
β”‚
β”β”€β”€ .env                                # ν™κ²½λ³€μ (API ν‚¤ λ“±)
β”β”€β”€ .env.example                        # ν™κ²½λ³€μ ν…ν”λ¦Ώ
β”β”€β”€ requirements.txt                    # Python μμ΅΄μ„±
β”β”€β”€ README.md                           # ν”„λ΅μ νΈ μ„¤λ…
β”β”€β”€ QUICKSTART.md                       # λΉ λ¥Έ μ‹μ‘ κ°€μ΄λ“
β””β”€β”€ test_api.sh                         # API ν…μ¤νΈ μ¤ν¬λ¦½νΈ

```

## ν•µμ‹¬ νμΌ μ„¤λ…

### π“„ main.py (117μ¤„)
- FastAPI μ• ν”λ¦¬μΌ€μ΄μ… μ΄κΈ°ν™”
- λΌμ°ν„° λ“±λ΅
- CORS λ―Έλ“¤μ›¨μ–΄ μ„¤μ •
- μƒλ…μ£ΌκΈ° κ΄€λ¦¬ (lifespan)

### π“„ config.py (35μ¤„)
- ν™κ²½λ³€μ λ΅λ“ (.env)
- μ„¤μ • μ‹±κΈ€ν†¤ μ κ³µ
- μΊμ‹ λ””λ ‰ν† λ¦¬ μλ™ μƒμ„±

### π“„ models.py (80μ¤„)
- Pydantic λ¨λΈ μ •μ
- API μ”μ²­/μ‘λ‹µ μ¤ν‚¤λ§
- λ°μ΄ν„° κ²€μ¦

### π“„ dart_client.py (149μ¤„)
- OPENDART API HTTP ν΄λΌμ΄μ–ΈνΈ
- Rate limiting ν†µν•©
- Exponential backoff μ¬μ‹λ„
- μ—λ¬ μ½”λ“ μ‚¬μ©μ μΉν™” λ©”μ‹μ§€ λ³€ν™

### π“„ corp_resolver.py (147μ¤„)
- corpCode.xml λ‹¤μ΄λ΅λ“ λ° νμ‹±
- νμ‚¬λ…/μΆ…λ©μ½”λ“ β†’ corp_code λ§¤ν•‘
- λ΅μ»¬ μΊμ‹± (30μΌ TTL)
- λ¶€λ¶„ μΌμΉ κ²€μƒ‰ μ§€μ›

### π“„ financial_service.py (118μ¤„)
- μ¬λ¬΄μ •λ³΄ API νΈμ¶
- SQLite μΊμ‹±
- κ³„μ • μ¶”μ¶ μ ν‹Έλ¦¬ν‹°

### π“„ ebitda_calculator.py (207μ¤„)
- EBITDA κ³„μ‚° λ΅μ§
- μμ—…μ΄μµ/κ°κ°€μƒκ°λΉ„/λ¬΄ν•μμ‚°μƒκ°λΉ„ μ¶”μ¶
- λ‹ΉκΈ°/λ„μ  κΈμ•΅ μλ™ νλ‹¨
- κ²½κ³  λ©”μ‹μ§€ μƒμ„±

### π“„ cache.py (132μ¤„)
- SQLite κΈ°λ° μΊμ‹± μ‹μ¤ν…
- μλ™ λ§λ£ μ²λ¦¬
- ν•΄μ‹ κΈ°λ° ν‚¤ μƒμ„±

### π“„ rate_limiter.py (101μ¤„)
- ν† ν° λ²„ν‚· μ•κ³ λ¦¬μ¦
- λΉ„λ™κΈ° Rate limiting
- Exponential backoff

### π“„ ebitda.py (130μ¤„)
- `/api/v1/ebitda` μ—”λ“ν¬μΈνΈ
- μ”μ²­ κ²€μ¦ (Query params)
- μ—λ¬ ν•Έλ“¤λ§
- μ‘λ‹µ κµ¬μ„±

## λ°μ΄ν„° ν”λ΅μ°

```
μ‚¬μ©μ μ”μ²­
    β†“
[ebitda.py] API μ—”λ“ν¬μΈνΈ
    β†“
[corp_resolver.py] νμ‚¬λ…/μΆ…λ©μ½”λ“ β†’ corp_code λ³€ν™
    β†“
[ebitda_calculator.py] EBITDA κ³„μ‚° μ‹μ‘
    β†“
[financial_service.py] μ¬λ¬΄μ •λ³΄ μ΅°ν
    β”β”€ [cache.py] μΊμ‹ ν™•μΈ
    β””β”€ [dart_client.py] OPENDART API νΈμ¶
            β”β”€ [rate_limiter.py] Rate limiting
            β””β”€ Exponential backoff μ¬μ‹λ„
    β†“
[ebitda_calculator.py] EBITDA κ³„μ‚°
    β”β”€ μμ—…μ΄μµ μ¶”μ¶ (μ†μµκ³„μ‚°μ„)
    β”β”€ κ°κ°€μƒκ°λΉ„ μ¶”μ¶ (ν„κΈνλ¦„ν‘)
    β”β”€ λ¬΄ν•μμ‚°μƒκ°λΉ„ μ¶”μ¶ (ν„κΈνλ¦„ν‘)
    β””β”€ EBITDA = ν•©κ³„
    β†“
[ebitda.py] μ‘λ‹µ κµ¬μ„± λ° λ°ν™
    β†“
JSON μ‘λ‹µ
```

## μΊμ‹± μ „λµ

### 1. corp_code λ§¤ν•‘ (νμΌ μΊμ‹)
- μ„μΉ: `data/cache/corp_code.xml`
- TTL: 30μΌ
- ν¬κΈ°: ~15MB (μ••μ¶• ν•΄μ  ν›„)
- κ°±μ‹ : μµμ΄ 1ν + 30μΌλ§λ‹¤

### 2. μ¬λ¬΄μ •λ³΄ (SQLite μΊμ‹)
- μ„μΉ: `data/cache/cache.db`
- TTL: 30μΌ (μ„¤μ • κ°€λ¥)
- ν‚¤: SHA256(corp_code, year, report_code, fs_div)
- μλ™ λ§λ£ μ •λ¦¬

## Rate Limiting

- κΈ°λ³Έκ°’: μ΄λ‹Ή 5ν
- μ•κ³ λ¦¬μ¦: ν† ν° λ²„ν‚·
- μ¬μ‹λ„: Exponential backoff (μµλ€ 3ν)
- λ°±μ¤ν”„ λ”λ μ΄: 1μ΄ β†’ 2μ΄ β†’ 4μ΄

## μ—λ¬ μ²λ¦¬

| μ—λ¬ μ½”λ“ | HTTP μƒνƒ | μ„¤λ… |
|---------|----------|------|
| 000 | 200 | μ •μƒ μ‘λ‹µ |
| 010 | 401 | λ“±λ΅λμ§€ μ•μ€ API ν‚¤ |
| 013 | 404 | λ°μ΄ν„° μ—†μ |
| 020 | 429 | μ”μ²­ μ ν• μ΄κ³Ό |
| 100 | 400 | μλ»λ νλΌλ―Έν„° |
| 800 | 403 | μ ‘μ† μ°¨λ‹¨ |

## μ½”λ“ ν†µκ³„

- μ΄ λΌμΈ μ: ~1,150μ¤„
- Python νμΌ: 13κ°
- μ„¤μ • νμΌ: 4κ°
- λ¬Έμ„ νμΌ: 3κ°
